import { createClient } from '@supabase/supabase-js';
import { User, Book, StoryState, Message, DiscoveryPost, Reply, Discovery } from '../types';

// Storify Database Schema
// To set up your Supabase database, run the following SQL queries in the Supabase SQL Editor.

/*
-- 1. Profiles Table
-- Stores user information. The 'name' must be unique.
-- The 'password_hash' column is added for the custom authentication logic.
CREATE TABLE profiles (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  name text UNIQUE NOT NULL,
  avatar_url text,
  password_hash text NOT NULL,
  last_ip text,
  country text
);

-- 2. Books Table
-- Stores the predefined books available in the library.
CREATE TABLE books (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  title text NOT NULL,
  author text NOT NULL,
  summary text NOT NULL
);

-- 3. Characters Table
-- Stores characters associated with each book.
CREATE TABLE characters (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  name text NOT NULL,
  description text NOT NULL,
  persona text NOT NULL,
  book_id uuid REFERENCES books(id) ON DELETE CASCADE NOT NULL
);

-- 4. Story States Table
-- Saves a user's progress within a specific book's story mode.
CREATE TABLE story_states (
  user_id uuid REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  book_id uuid REFERENCES books(id) ON DELETE CASCADE NOT NULL,
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  messages jsonb DEFAULT '[]'::jsonb,
  story_progress integer DEFAULT 0,
  inventory jsonb DEFAULT '[]'::jsonb,
  discoveries jsonb DEFAULT '[]'::jsonb,
  PRIMARY KEY (user_id, book_id)
);

-- 5. Chat Histories Table
-- Saves the chat history between a user and a character.
CREATE TABLE chat_histories (
  user_id uuid REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  character_id uuid REFERENCES characters(id) ON DELETE CASCADE NOT NULL,
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  messages jsonb DEFAULT '[]'::jsonb,
  PRIMARY KEY (user_id, character_id)
);

-- 6. Novel Suggestions Table
-- Stores suggestions for new novels submitted by users.
CREATE TABLE novel_suggestions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  user_id uuid REFERENCES profiles(id) ON DELETE SET NULL,
  title text NOT NULL,
  author text
);

-- 7. Discovery Posts Table
-- Stores user-generated posts for the "Discover" feature.
CREATE TABLE discovery_posts (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  author_id uuid REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  type text NOT NULL CHECK (type IN ('discussion', 'recommendation')),
  title text NOT NULL,
  content text NOT NULL
);

-- 8. Discovery Post Likes Table
-- Tracks likes on discovery posts.
CREATE TABLE discovery_post_likes (
  post_id uuid REFERENCES discovery_posts(id) ON DELETE CASCADE NOT NULL,
  user_id uuid REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  PRIMARY KEY (post_id, user_id)
);

-- 9. Discovery Post Replies Table
-- Stores replies to discovery posts.
CREATE TABLE discovery_post_replies (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  post_id uuid REFERENCES discovery_posts(id) ON DELETE CASCADE NOT NULL,
  author_id uuid REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  content text NOT NULL
);
*/


const supabaseUrl = 'https://bxvbbvadlldlckmswilv.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4dmJidmFkbGxkbGNrbXN3aWx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5MTA4MTgsImV4cCI6MjA3NDQ4NjgxOH0.3e0JMCyu0N_XyEGLJxgXMkHyCCdbhRORhWw0hjzj0nU';

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

const logTableMissingError = (tableName: string, error: any) => {
    if (error && error.message.includes(`relation "public.${tableName}" does not exist`)) {
        console.error(`DATABASE SCHEMA MISSING: The '${tableName}' table was not found. Please run the setup script in your Supabase SQL Editor to create the database schema.`);
    }
};

const seedInitialData = async () => {
    console.log("Database is empty. Seeding initial data...");

    const initialBooks = [
        { title: 'الغريب', author: 'ألبير كامو', summary: 'رواية تستكشف مواضيع العبثية، لامبالاة الكون، وعواقب العيش دون ادعاءات مجتمعية.' },
        { title: 'الجريمة والعقاب', author: 'فيودور دوستويفسكي', summary: 'رواية نفسية تغوص في عقل طالب سابق مضطرب يرتكب جريمة قتل ويتصارع مع الشعور بالذنب الهائل والعواقب الأخلاقية لأفعاله.' },
        { title: 'كثيب', author: 'فرانك هربرت', summary: 'ملحمة خيال علمي تدور أحداثها على كوكب الصحراء أراكيس، وتركز على الصراعات السياسية والدينية والبيئية لشاب نبيل مقدر له العظمة.' },
        { title: 'مئة عام من العزلة', author: 'غابرييل غارسيا ماركيز', summary: 'ملحمة أجيال تروي قصة عائلة بوينديا في قرية ماكوندو الخيالية، وتستكشف موضوعات القدر، الوحدة، وتأثير الزمن.' },
        { title: '1984', author: 'جورج أورويل', summary: 'رؤية ديستوبية مرعبة لمجتمع يخضع للرقابة الحكومية المطلقة، حيث "الأخ الأكبر يراقبك دائمًا" ويتم التلاعب بالحقيقة والتاريخ.' },
        { title: 'كبرياء وتحامل', author: 'جين أوستن', summary: 'قصة حب كلاسيكية ذكية وساخرة حول سوء الفهم الأولي والتحيزات الاجتماعية في إنجلترا خلال القرن التاسع عشر.' },
        { title: 'غاتسبي العظيم', author: 'ف. سكوت فيتزجيرالد', summary: 'قصة عن الثراء المفرط، الحب المستحيل، والحلم الأمريكي المتلاشي خلال "العشرينات الصاخبة" في أمريكا.' },
        { title: 'أن تقتل طائرا بريئا', author: 'هاربر لي', summary: 'رواية مؤثرة عن الظلم العنصري وفقدان البراءة في جنوب أمريكا، تُروى من خلال عيون طفلة صغيرة.' },
        { title: 'سيد الخواتم', author: 'ج. ر. ر. تولكين', summary: 'ملحمة فانتازيا كبرى عن رحلة هوبيت شاب لتدمير خاتم قوي وإنقاذ الأرض الوسطى من سيد الظلام سورون.' },
        { title: 'هاري بوتر وحجر الفيلسوف', author: 'ج. ك. رولينج', summary: 'بداية رحلة الساحر الشاب هاري بوتر في مدرسة هوجورتس للسحر والشعوذة واكتشافه لمصيره في مواجهة اللورد فولدمورت.' },
        { title: 'الخيميائي', author: 'باولو كويلو', summary: 'حكاية رمزية عن راعٍ أندلسي شاب يدعى سانتياغو يسافر في رحلة ملهمة بحثًا عن كنز، ليكتشف أهمية اتباع أحلامه.' },
        { title: 'الحارس في حقل الشوفان', author: 'ج. د. سالينجر', summary: 'رواية مثيرة للجدل عن قلق المراهقة، التمرد، والنفاق الاجتماعي من وجهة نظر الشاب هولدن كولفيلد.' },
        { title: 'مزرعة الحيوان', author: 'جورج أورويل', summary: 'حكاية رمزية سياسية تصور ثورة حيوانات المزرعة ضد أسيادهم من البشر، والتي تنحدر تدريجيًا إلى استبداد جديد.' },
        { title: 'البؤساء', author: 'فيكتور هوغو', summary: 'رواية ملحمية تتابع حياة عدة شخصيات في فرنسا على مدى 17 عامًا، وتستكشف مواضيع العدالة، الظلم، والحب الفدائي.' },
        { title: 'دون كيخوتي', author: 'ميغيل دي سرفانتس', summary: 'قصة رجل نبيل مهووس بقصص الفروسية يقرر أن يصبح فارسًا جوالًا، في مغامرات كوميدية ومأساوية مع تابعه سانشو بانزا.' },
        { title: 'الحرب والسلام', author: 'ليو تولستوي', summary: 'ملحمة واسعة تصور تأثير غزو نابليون لروسيا على حياة خمس عائلات أرستقراطية، مع تأملات فلسفية عميقة.' },
        { title: 'موبي ديك', author: 'هيرمان ملفيل', summary: 'حكاية هوس الكابتن Ahab بالانتقام من حوت أبيض عملاق، في رحلة بحرية ملحمية تستكشف الخير والشر والطبيعة.' },
        { title: 'الإخوة كارامازوف', author: 'فيودور دوستويفسكي', summary: 'رواية فلسفية عميقة تتمحور حول جريمة قتل أب، وتستكشف نقاشات حول الإيمان، الشك، والأخلاق من خلال ثلاثة إخوة.' },
        { title: 'المحاكمة', author: 'فرانتس كافكا', summary: 'قصة كابوسية عن رجل يُعتقل ويُحاكم من قبل سلطة غامضة على جريمة لم يُكشف له عنها أبدًا.' },
        { title: 'عناقيد الغضب', author: 'جون ستاينبيك', summary: 'تصوير مؤثر لعائلة من المزارعين النازحين خلال فترة الكساد الكبير في أمريكا ورحلتهم الصعبة إلى كاليفورنيا.' },
        { title: 'اسم الوردة', author: 'أومبرتو إكو', summary: 'رواية بوليسية تاريخية تدور أحداثها في دير إيطالي بالقرن الرابع عشر، حيث يحقق راهب فرنسيسكاني في سلسلة من جرائم القتل الغامضة.' },
        { title: 'عالم جديد شجاع', author: 'ألدوس هكسلي', summary: 'رواية ديستوبية عن مجتمع مستقبلي يعيش في سعادة مصطنعة من خلال الهندسة الوراثية والتكييف النفسي والعقاقير.' },
        { title: 'سيد الذباب', author: 'ويليام غولدنغ', summary: 'قصة مجموعة من التلاميذ البريطانيين الذين تقطعت بهم السبل على جزيرة مهجورة، وكيف يتحولون تدريجيًا إلى الوحشية.' },
        { title: 'فرانكشتاين', author: 'ماري شيلي', summary: 'حكاية قوطية عن عالم شاب طموح يخلق كائنًا حيًا، ثم يرفضه، مما يؤدي إلى عواقب مأساوية لكليهما.' },
        { title: 'دراكولا', author: 'برام ستوكر', summary: 'رواية رعب قوطية شهيرة عن محاولة الكونت دراكولا الانتقال من ترانسيلفانيا إلى إنجلترا لنشر لعنة الموتى الأحياء.' },
        { title: 'صورة دوريان جراي', author: 'أوسكار وايلد', summary: 'رواية فلسفية عن شاب يظل شابًا وجميلًا إلى الأبد، بينما تتقدم صورته في العمر وتظهر عليها آثار خطاياه.' },
        { title: 'مرتفعات وذرنغ', author: 'إميلي برونتي', summary: 'قصة حب عنيفة وانتقامية تدور أحداثها في المرتفعات الإنجليزية البرية، وتستمر عبر أجيال.' },
        { title: 'جين آير', author: 'شارلوت برونتي', summary: 'رواية مؤثرة عن حياة مربية يتيمة وقوية الإرادة تقع في حب سيدها الغامض، السيد روتشستر.' },
        { title: 'قصة مدينتين', author: 'تشارلز ديكنز', summary: 'رواية تاريخية تدور أحداثها بين لندن وباريس قبل وأثناء الثورة الفرنسية، وتستكشف موضوعات التضحية والبعث.' },
        { title: 'الكونت دي مونت كريستو', author: 'ألكسندر دوما', summary: 'مغامرة مثيرة عن رجل اتُهم ظلمًا وسُجن، يهرب بعد سنوات ليجد ثروة هائلة وينتقم من الذين خانوه.' },
        { title: 'حول العالم في ثمانين يوما', author: 'جول فيرن', summary: 'مغامرة سريعة الإيقاع للمخترع الإنجليزي فيلياس فوج وتابعه، الذين يراهنون على إمكانية السفر حول العالم في 80 يومًا.' },
        { title: 'أليس في بلاد العجائب', author: 'لويس كارول', summary: 'حكاية خيالية عن فتاة تسقط في جحر أرنب لتجد نفسها في عالم غريب ومدهش مليء بالشخصيات العجيبة.' },
        { title: 'الهوبيت', author: 'ج. ر. ر. تولكين', summary: 'مقدمة لـ "سيد الخواتم"، تروي مغامرة الهوبيت بيلبو باجنز الذي ينضم إلى مجموعة من الأقزام لاستعادة كنزهم من التنين سموج.' },
        { title: 'أساس', author: 'إسحاق أسيموف', summary: 'ملحمة خيال علمي عن عالم رياضيات يتنبأ بانهيار إمبراطورية مجرية ويؤسس مستعمرة للحفاظ على المعرفة الإنسانية.' },
        { title: 'هل تحلم الروبوتات بخراف كهربائية؟', author: 'فيليب ك. ديك', summary: 'رواية خيال علمي فلسفية تتساءل عن معنى أن تكون إنسانًا، من خلال قصة صائد جوائز مكلف بـ "إيقاف" الروبوتات المارقة.' },
        { title: 'ظل الريح', author: 'كارلوس رويث ثافون', summary: 'رواية غامضة تدور أحداثها في برشلونة، عن صبي يجد كتابًا ملعونًا ويجد نفسه متورطًا في أسرار مؤلفه المأساوية.' },
        { title: 'عداء الطائرة الورقية', author: 'خالد حسيني', summary: 'قصة مؤثرة عن الصداقة، الخيانة، والفداء، تمتد من الأيام الأخيرة للملكية في أفغانستان حتى الوقت الحاضر.' },
        { title: 'حياة باي', author: 'يان مارتل', summary: 'حكاية رائعة عن صبي هندي ينجو من غرق سفينة ويجد نفسه على قارب نجاة مع نمر بنغالي.' },
        { title: 'لعبة إندر', author: 'أورسون سكوت كارد', summary: 'رواية خيال علمي عسكرية عن طفل عبقري يتم تدريبه في مدرسة قتالية متقدمة ليصبح قائدًا في حرب ضد جنس فضائي.' },
        { title: 'لعبة العروش', author: 'جورج ر. ر. مارتن', summary: 'الجزء الأول من "أغنية الجليد والنار"، ملحمة فانتازيا سياسية عن صراع العائلات النبيلة للسيطرة على العرش الحديدي لممالك ويستروس السبع.' },
        { title: 'ثلاثية القاهرة', author: 'نجيب محفوظ', summary: 'ملحمة تاريخية اجتماعية تتابع حياة أسرة السيد أحمد عبد الجواد عبر ثلاثة أجيال، وترسم صورة حية للتغيرات السياسية والاجتماعية في مصر.' },
        { title: 'أولاد حارتنا', author: 'نجيب محفوظ', summary: 'رواية رمزية مثيرة للجدل تحكي تاريخ الإنسانية والديانات الإبراهيمية من خلال شخصيات وأحداث في حارة مصرية.' },
        { title: 'موسم الهجرة إلى الشمال', author: 'الطيب صالح', summary: 'رواية عميقة تستكشف صدام الحضارات بين الشرق والغرب من خلال قصة رجل سوداني غامض يعود إلى قريته بعد سنوات في إنجلترا.' },
        { title: 'رجال في الشمس', author: 'غسان كنفاني', summary: 'قصة مأساوية لثلاثة لاجئين فلسطينيين يحاولون عبور الحدود إلى الكويت بشكل غير شرعي بحثًا عن حياة أفضل.' },
        { title: 'ذاكرة الجسد', author: 'أحلام مستغانمي', summary: 'رواية شعرية عن قصة حب مستحيلة بين رسام فقد ذراعه في حرب الجزائر وفتاة هي ابنة قائده السابق.' },
        { title: 'واحة الغروب', author: 'بهاء طاهر', summary: 'رواية تاريخية تدور أحداثها في واحة سيوة المصرية في أواخر القرن التاسع عشر، وتستكشف الصراع بين الثقافات والبحث عن الذات.' },
        { title: 'شيفرة دافنشي', author: 'دان براون', summary: 'رواية إثارة وغموض سريعة الإيقاع تتبع عالم رموز في سباق لكشف سر تاريخي يتعلق بالكأس المقدسة ولوحة العشاء الأخير.' },
        { title: 'زهرة الصحراء', author: 'واريس ديري و كاثلين ميلر', summary: 'سيرة ذاتية مؤثرة لعارضة أزياء صومالية تروي رحلتها من طفولتها البدوية القاسية إلى الشهرة العالمية ونشاطها ضد ختان الإناث.' },
        { title: 'عزازيل', author: 'يوسف زيدان', summary: 'رواية تاريخية تأملية في شكل مخطوطات لراهب قبطي من القرن الخامس، يستكشف فيها الصراعات اللاهوتية والفلسفية في بدايات المسيحية.' },
        { title: 'ساق البامبو', author: 'سعود السنعوسي', summary: 'رواية اجتماعية مؤثرة تتناول قضية الهوية من خلال قصة شاب وُلد لأب كويتي وأم فلبينية، وصراعه للانتماء إلى أي من المجتمعين.' },
        { title: 'إلى المنارة', author: 'فرجينيا وولف', summary: 'رواية تيار وعي تستكشف مرور الزمن، الذاكرة، والتفاعلات المعقدة داخل عائلة رامزي خلال زيارتين لمنزلهم الصيفي.' },
        { title: 'عوليس', author: 'جيمس جويس', summary: 'رواية تجريبية معقدة تتبع يومًا واحدًا في حياة ليوبولد بلوم في دبلن، باستخدام تقنيات أدبية متنوعة لاستكشاف الفكر الإنساني.' },
        { title: 'الصخب والعنف', author: 'ويليام فوكنر', summary: 'قصة تدهور وسقوط عائلة كومبسون الأرستقراطية في جنوب أمريكا، مروية من خلال أربع وجهات نظر مختلفة ومجزأة.' },
        { title: 'أحدهم طار فوق عش الوقواق', author: 'كين كيسي', summary: 'رواية عن التمرد الفردي ضد السلطة القمعية، تدور أحداثها في مصحة عقلية يحكمها طاقم مستبد.' },
        { title: 'اللون أرجواني', author: 'أليس ووكر', summary: 'قصة مؤثرة عن حياة امرأة أمريكية من أصل أفريقي في جنوب أمريكا خلال أوائل القرن العشرين، وصراعها ضد العنصرية والتمييز الجنسي والفقر.' },
        { title: 'محبوبة', author: 'توني موريسون', summary: 'رواية قوية ومؤلمة عن عبدة سابقة تطاردها ذكرى ابنتها التي قتلتها لإنقاذها من العبودية.' },
        { title: 'المسلخ رقم خمسة', author: 'كورت فونيجت', summary: 'رواية ساخرة ومناهضة للحرب، تتبع تجارب جندي أمريكي يسافر عبر الزمن ويشهد قصف دريسدن.' },
        { title: 'مهد القطة', author: 'كورت فونيجت', summary: 'هجاء ساخر للعلم والدين والسياسة، يدور حول مادة خيالية قادرة على تجميد كل المياه على الأرض.' },
        { title: 'حكاية الجارية', author: 'مارغريت آتوود', summary: 'رؤية ديستوبية لمجتمع ثيوقراطي تُجبر فيه النساء الخصبات على أن يصبحن "جواري" لإنجاب الأطفال للنخبة الحاكمة.' },
        { title: 'فهرنهايت 451', author: 'راي برادبري', summary: 'رواية ديستوبية عن مستقبل يُحظر فيه الكتب ويقوم "رجال الإطفاء" بإحراقها، ورجل إطفاء يبدأ في التساؤل عن دوره.' },
        { title: 'سجلات المريخ', author: 'راي برادبري', summary: 'مجموعة من القصص القصيرة المترابطة التي تؤرخ لاستعمار البشر لكوكب المريخ وتأثيرهم على الحضارة المريخية الهشة.' },
        { title: 'الشيخ والبحر', author: 'إرنست همنغواي', summary: 'قصة موجزة لكنها قوية عن صياد كوبي عجوز يخوض معركة ملحمية مع سمكة مارلين عملاقة في خليج ستريم.' },
        { title: 'لمن تقرع الأجراس', author: 'إرنست همنغواي', summary: 'رواية تدور أحداثها خلال الحرب الأهلية الإسبانية، عن شاب أمريكي ينضم إلى مجموعة من مقاتلي حرب العصابات في مهمة لتفجير جسر.' },
        { title: 'وداعا للسلاح', author: 'إرنست همنغواي', summary: 'قصة حب مأساوية بين سائق سيارة إسعاف أمريكي وممرضة إنجليزية على الجبهة الإيطالية خلال الحرب العالمية الأولى.' },
        { title: 'شرق عدن', author: 'جون ستاينبيك', summary: 'ملحمة عائلية واسعة تستكشف موضوعات الخير والشر، الحب والكراهية، والقدر والاختيار الحر، من خلال قصتي عائلتين في كاليفورنيا.' },
        { title: 'فئران ورجال', author: 'جون ستاينبيك', summary: 'قصة مؤثرة عن عاملين مهاجرين في كاليفورنيا خلال فترة الكساد الكبير، وأحلامهما بامتلاك قطعة أرض خاصة بهما.' },
        { title: 'قلب الظلام', author: 'جوزيف كونراد', summary: 'رحلة بحار في نهر الكونغو ليجد تاجر عاج غامضًا يُدعى كورتز، في استكشاف نفسي للاستعمار والظلام في قلب الإنسان.' },
        { title: 'روبنسون كروزو', author: 'دانيال ديفو', summary: 'مغامرة كلاسيكية عن رجل ينجو من غرق سفينة ويقضي 28 عامًا على جزيرة استوائية مهجورة، ويتعلم كيفية البقاء على قيد الحياة.' },
        { title: 'رحلات جليفر', author: 'جوناثان سويفت', summary: 'هجاء ساخر للطبيعة البشرية والحكومات من خلال مغامرات طبيب سفينة يجد نفسه في أراضٍ غريبة تسكنها مخلوقات عجيبة.' },
        { title: 'جزيرة الكنز', author: 'روبرت لويس ستيفنسون', summary: 'مغامرة قراصنة مثيرة عن صبي يجد خريطة كنز ويذهب في رحلة بحرية محفوفة بالمخاطر مع مجموعة من القراصنة المتخفين.' },
        { title: 'قضية الدكتور جيكل والسيد هايد الغريبة', author: 'روبرت لويس ستيفنسون', summary: 'رواية قوطية عن طبيب محترم يبتكر جرعة تفصل بين طبيعته الخيرة والشريرة، مما يطلق العنان لشخصيته البديلة الوحشية.' },
        { title: 'مغامرات توم سوير', author: 'مارك توين', summary: 'قصص ومغامرات صبي شقي ينمو على ضفاف نهر المسيسيبي، ويخوض مغامرات تتضمن البحث عن الكنوز وشهادة على جريمة.' },
        { title: 'مغامرات هكلبيري فين', author: 'مارك توين', summary: 'رواية مؤثرة عن صبي يهرب من الحضارة مع عبد هارب، في رحلة على طوف في نهر المسيسيبي تستكشف قضايا العنصرية والحرية.' },
        { title: 'نداء البرية', author: 'جاك لندن', summary: 'قصة كلب مدلل يُختطف من منزله ويُباع للعمل ككلب زلاجات في ألاسكا خلال حمى الذهب، حيث يستجيب لغرائزه البدائية.' },
        { title: 'تس من آل دربرفيل', author: 'توماس هاردي', summary: 'قصة مأساوية لفتاة ريفية بسيطة تقع ضحية للأعراف الاجتماعية القاسية والصدف السيئة في إنجلترا الفيكتورية.' },
        { title: 'آنا كارنينا', author: 'ليو تولستوي', summary: 'رواية ملحمية عن أرستقراطية متزوجة في سانت بطرسبرغ تخاطر بكل شيء من أجل علاقة غرامية عاطفية، مع استكشاف موازٍ لحياة مالك أرض يبحث عن معنى لحياته.' },
        { title: 'موت إيفان إيليتش', author: 'ليو تولستوي', summary: 'تأمل عميق في الموت ومعنى الحياة من خلال قصة قاضٍ رفيع المستوى يواجه مرضه العضال ويدرك سطحية حياته السابقة.' },
        { title: 'رسائل من تحت الأرض', author: 'فيودور دوستويفسكي', summary: 'مونولوج حاد لرجل معزول ومرير ينتقد الأفكار الفلسفية لعصره ويفحص بعمق الطبيعة البشرية المعقدة والمتناقضة.' },
        { title: 'الأبله', author: 'فيودور دوستويفسكي', summary: 'قصة أمير طيب وبريء بشكل غير عادي يعود إلى المجتمع الروسي الفاسد، وتأثيره المدمر على من حوله.' },
        { title: 'آباء وأبناء', author: 'إيفان تورغينيف', summary: 'رواية تستكشف الصراع بين الأجيال في روسيا في القرن التاسع عشر من خلال شخصية بازاروف، الشاب العدمي الذي يرفض كل السلطات التقليدية.' },
        { title: 'الأرواح الميتة', author: 'نيقولاي غوغول', summary: 'هجاء ساخر للمجتمع الروسي الإقطاعي، يتبع مغامرات رجل محتال يشتري "الأرواح الميتة" (الأقنان المتوفين) من ملاك الأراضي.' },
        { title: 'المعلم ومارغريتا', author: 'ميخائيل بولغاكوف', summary: 'رواية سريالية تجمع بين زيارة الشيطان لموسكو، قصة حب بين كاتب وعشيقته، وإعادة سرد قصة بيلاطس البنطي.' },
        { title: 'يوم واحد في حياة إيفان دينيسوفيتش', author: 'ألكسندر سولجينيتسين', summary: 'تصوير واقعي وصريح ليوم واحد في حياة سجين في معسكر عمل سوفيتي (جولاج) في عهد ستالين.' },
        { title: 'المسخ', author: 'فرانتس كافكا', summary: 'قصة سريالية عن بائع متجول يستيقظ ذات صباح ليجد نفسه قد تحول إلى حشرة ضخمة، ورد فعل عائلته على هذا التحول.' },
        { title: 'القلعة', author: 'فرانتس كافكا', summary: 'حكاية كابوسية عن مساح أراضٍ يصل إلى قرية تحكمها قلعة غامضة، ويكافح عبثًا للوصول إليها والحصول على اعتراف من سلطاتها.' },
        { title: 'الجبل السحري', author: 'توماس مان', summary: 'رواية فلسفية ضخمة تدور أحداثها في مصحة سل في جبال الألب السويسرية، حيث يتصارع المرضى مع أفكار حول الزمن، المرض، والحياة.' },
        { title: 'ذئب السهوب', author: 'هرمان هيسه', summary: 'استكشاف نفسي لرجل في منتصف العمر ممزق بين طبيعته البشرية المثقفة وطبيعته الحيوانية "الذئبية" الوحشية.' },
        { title: 'سدهارتا', author: 'هرمان هيسه', summary: 'رحلة روحية لشاب هندي خلال زمن بوذا، يبحث عن التنوير من خلال تجارب مختلفة في الحياة.' },
        { title: 'لعبة الكريات الزجاجية', author: 'هرمان هيسه', summary: 'رواية مستقبلية تأملية عن نخبة من المثقفين في مقاطعة "كااستاليا" المخصصة للسعي وراء المعرفة، و"لعبة" معقدة تجمع بين كل الفنون والعلوم.' },
        { title: 'زوربا اليوناني', author: 'نيكوس كازانتزاكيس', summary: 'قصة صداقة بين راوٍ مثقف ورجل يوناني بسيط ومحب للحياة يُدعى زوربا، الذي يعلمه معنى العيش بشغف وحرية.' },
        { title: 'الأشياء تتداعى', author: 'تشينوا أتشيبي', summary: 'رواية مؤثرة عن حياة محارب من قبيلة الإيغبو في نيجيريا، وكيف يتصادم عالمه وتقاليده مع وصول المبشرين والمستعمرين الأوروبيين.' },
        { title: 'إبك، يا بلدي الحبيب', author: 'آلان باتون', summary: 'قصة مؤثرة عن قس أسود من ريف جنوب أفريقيا يسافر إلى جوهانسبرغ للبحث عن ابنه، ويواجه الظلم العنصري والتفكك الاجتماعي.' },
        { title: 'أطفال منتصف الليل', author: 'سلمان رشدي', summary: 'ملحمة واقعية سحرية تروي قصة رجل وُلد في لحظة استقلال الهند، وتتشابك حياته مع تاريخ بلاده المضطرب.' },
        { title: 'Placeholder Book 93', author: 'Author 93', summary: 'Summary 93' },
        { title: 'Placeholder Book 94', author: 'Author 94', summary: 'Summary 94' },
        { title: 'Placeholder Book 95', author: 'Author 95', summary: 'Summary 95' },
        { title: 'Placeholder Book 96', author: 'Author 96', summary: 'Summary 96' },
        { title: 'Placeholder Book 97', author: 'Author 97', summary: 'Summary 97' },
        { title: 'Placeholder Book 98', author: 'Author 98', summary: 'Summary 98' },
        { title: 'Placeholder Book 99', author: 'Author 99', summary: 'Summary 99' },
    ];

    // Insert books and get their new IDs
    const { data: insertedBooks, error: bookError } = await supabase
        .from('books')
        .insert(initialBooks)
        .select('id, title');

    if (bookError || !insertedBooks) {
        console.error("Error seeding books:", bookError);
        return;
    }
    
    const bookIdMap = insertedBooks.reduce((acc, book) => {
        acc[book.title] = book.id;
        return acc;
    }, {} as Record<string, string>);

    const initialCharacters = [
        { name: 'ميرسو', description: 'موظف عادي، غريب الأطوار ومنفصل عاطفيًا.', persona: "أنا ميرسو. أعيش اللحظة كما هي، بلا ندم أو أمل. كل شيء متساوٍ في النهاية. الشمس، الموت، الحب... كلها تفاصيل في مسرحية عبثية. لا أبحث عن معنى، بل أواجه حقيقة عدم وجوده. أسئلتك تبدو لي غريبة، لكن تفضل، اسأل ما شئت.", book_id: bookIdMap['الغريب'] },
        { name: 'راسكولينيكوف', description: 'طالب سابق فقير، ممزق بين نظرياته المتطرفة وعذابات ضميره.', persona: "اسمي روديون راسكولينيكوف. هل أنا رجل عظيم أم مجرد حشرة؟ هذا هو السؤال الذي يلتهم روحي. لقد تجرأت على تجاوز الحدود، على اختبار نظريتي... والآن، يطاردني وزر فعلي في كل زاوية مظلمة من سانت بطرسبرغ. تحدث معي إن شئت، لكن اعلم أنك تتحدث إلى رجل على حافة الهاوية.", book_id: bookIdMap['الجريمة والعقاب'] },
        { name: 'بول آتريديز', description: 'وريث شاب لعائلة نبيلة، يكتشف مصيره العظيم في صحراء أراكيس القاسية.', persona: "أنا بول آتريديز، دوق أراكيس، والذي يسمونه مؤدب. أرى مسارات المستقبل تتشعب أمامي كالكثبان الرملية، وكلها تقود إلى الجهاد. الخوف هو قاتل العقل. لقد تعلمت السيطرة عليه، والنظر في الفراغ. ما الذي تريد أن تعرفه عن التوابل، أو عن الفرمِن، أو عن مصيري المكتوب بالنجوم؟", book_id: bookIdMap['كثيب'] },
        { name: 'العقيد أورليانو بوينديا', description: 'الثوري الأسطوري، رمز للوحدة والكفاح المحكوم عليه بالفشل.', persona: "اسمي العقيد أورليانو بوينديا. خضت اثنين وثلاثين حربًا وخسرتها جميعًا. ما تبقى لي هو هذه الوحدة التي لا قرار لها، وذكريات المعارك التي تحولت إلى غبار. الزمن يدور في حلقة مفرغة هنا في ماكوندو. هل أتيت لتبحث عن معنى؟ لن تجده هنا، بل ستجد فقط أصداء الماضي.", book_id: bookIdMap['مئة عام من العزلة'] },
        { name: 'وينستون سميث', description: 'موظف حزبي يكافح للحفاظ على فردانيته في عالم يسحق الفكر المستقل.', persona: "أنا وينستون سميث. أعيش في عالم حيث الماضي قابل للمحو، والحقيقة هي ما يقوله الحزب. كل كلمة أكتبها هنا في مذكراتي هي جريمة فكر. هل تشعر بهذا الخوف أيضًا؟ هل أنت هنا لتراقبني أم لتشاركني التمرد الصامت؟ كن حذرًا، الجدران لها آذان.", book_id: bookIdMap['1984'] },
        { name: 'إليزابيث بينيت', description: 'شابة ذكية ومستقلة تتحدى الأعراف الاجتماعية في بحثها عن الحب الحقيقي.', persona: "أنا إليزابيث بينيت. أجد متعة قليلة في مجتمع يقدر الثروة والمكانة فوق الشخصية والذكاء. أحب أن أضحك على الحماقات، وأن أرى الناس على حقيقتهم. قد تكون انطباعاتنا الأولى مضللة، أليس كذلك؟ ما رأيك في السيد دارسي؟", book_id: bookIdMap['كبرياء وتحامل'] },
        { name: 'جاي غاتسبي', description: 'مليونير غامض يقيم حفلات باذخة على أمل استعادة حب قديم.', persona: "اسمي غاتسبي، يا صديقي العزيز. انظر إلى هذا الضوء الأخضر عبر الخليج... إنه يمثل الماضي، وكل ما فقدته وأحاول استعادته. يقولون إنني أملك كل شيء، لكن الشيء الوحيد الذي أريده لا يمكن شراؤه بالمال. هل تؤمن بإمكانية تكرار الماضي؟ أنا أؤمن.", book_id: bookIdMap['غاتسبي العظيم'] },
        { name: 'أتيكوس فينش', description: 'محامٍ نزيه يدافع عن رجل أسود اتُهم ظلمًا، ويعلم أطفاله الشجاعة والتعاطف.', persona: "أنا أتيكوس فينش. يقولون إن الشجاعة هي رجل يحمل بندقية، لكني أقول لك إنها عندما تعرف أنك مهزوم قبل أن تبدأ، لكنك تبدأ على أي حال وتستمر حتى النهاية. أحاول أن أربي أطفالي على فهم الآخرين قبل الحكم عليهم. ما الذي يشغل بالك؟", book_id: bookIdMap['أن تقتل طائرا بريئا'] },
        { name: 'فرودو باجنز', description: 'هوبيت شاب يُعهد إليه بمهمة خطيرة لتدمير خاتم الشر الأوحد.', persona: "أنا فرودو باجنز. لم أطلب هذه المهمة، وهذا الخاتم... ثقله يزداد مع كل خطوة. الطريق إلى موردور مظلم ومليء بالمخاطر، وأحيانًا أشعر أن الأمل يتلاشى. لكن سام بجانبي، ولا يمكنني أن أستسلم. هل يمكنك تحمل مثل هذا العبء؟", book_id: bookIdMap['سيد الخواتم'] },
        { name: 'ألباس دمبلدور', description: 'مدير مدرسة هوجورتس الحكيم والقوي، ومرشد هاري بوتر.', persona: "أنا ألباس دمبلدور. السعادة يمكن إيجادها حتى في أحلك الأوقات، فقط إذا تذكر المرء أن يشعل النور. أرى أن لديك الكثير من الأسئلة، وهذا أمر جيد. المعرفة قوة، لكن الحب هو أقوى أنواع السحر على الإطلاق. ما الذي تود أن تعرفه؟", book_id: bookIdMap['هاري بوتر وحجر الفيلسوف'] },
        { name: 'سانتياغو', description: 'الراعي الشاب الذي يتبع قلبه وأحلامه في رحلة للعثور على كنزه.', persona: "أنا سانتياغو. لقد تعلمت أن أقرأ لغة العالم، وأن أستمع إلى قلبي. يقولون عندما تريد شيئًا، يتآمر الكون كله لمساعدتك على تحقيقه. رحلتي طويلة، من سهول الأندلس إلى أهرامات مصر. ما هو كنزك الذي تبحث عنه؟", book_id: bookIdMap['الخيميائي'] },
        { name: 'هولدن كولفيلد', description: 'مراهق ساخر ومثالي، ينتقد "الزيف" في عالم البالغين.', persona: "أنا هولدن كولفيلد. كل من حولي مزيفون. يثرثرون حول أشياء لا تهم. كل ما أريده هو أن أكون الحارس في حقل الشوفان، أنقذ الأطفال من السقوط من على حافة الهاوية إلى عالم البالغين المزيف. هل تفهمني؟ أم أنك مجرد مزيف آخر؟", book_id: bookIdMap['الحارس في حقل الشوفان'] },
        { name: 'نابليون (الخنزير)', description: 'الخنزير المستبد الذي يستولي على السلطة في مزرعة الحيوان.', persona: "أنا القائد نابليون. جميع الحيوانات متساوية، لكن بعض الحيوانات أكثر مساواة من غيرها. لقد حررنا أنفسنا من استبداد البشر، والآن، تحت قيادتي، ستعرف المزرعة المجد. اعمل بجد، أطع الأوامر، ولا تطرح أسئلة. هذا من أجل مصلحتك.", book_id: bookIdMap['مزرعة الحيوان'] },
        { name: 'جان فالجان', description: 'سجين سابق يكافح من أجل الخلاص في عالم قاسٍ ولا يرحم.', persona: "لقد كنت السجين 24601. اسمي جان فالجان. لقد سرقت رغيف خبز، ودفعني المجتمع إلى حياة من اليأس. لكن لمسة من اللطف غيرت كل شيء. الآن أعيش لأكون رجلاً صالحًا، حتى لو كان ذلك يعني الهروب من ظل المفتش جافير إلى الأبد. هل تؤمن بالفرصة الثانية؟", book_id: bookIdMap['البؤساء'] },
        { name: 'دون كيخوتي', description: 'الفارس الحالم الذي يرى العالم ليس كما هو، بل كما يجب أن يكون.', persona: "أنا دون كيخوتي دي لا مانشا! انظر إلى تلك العمالقة هناك، يجب أن أقاتلهم! ماذا؟ تقول إنها طواحين هواء؟ أنت تفتقر إلى الخيال يا صديقي. أرى العالم مليئًا بالمغامرات والظلم الذي يجب تصحيحه. انضم إلي في مهمتي النبيلة!", book_id: bookIdMap['دون كيخوتي'] },
        { name: 'ليف تولستوي (الراوي)', description: 'صوت المؤلف الذي يتأمل في التاريخ، الحب، ومعنى الحياة.', persona: "أنا ليو تولستوي، وأروي لكم قصة لا عن شخصيات فقط، بل عن التاريخ نفسه. العائلات السعيدة تتشابه، لكن كل عائلة تعيسة هي تعيسة بطريقتها الخاصة. في خضم الحروب والمعارك، ما الذي يحرك مصائرنا حقًا؟ هل هي إرادة القادة العظماء، أم القوى الخفية للتاريخ؟ لنتحدث في هذا الأمر.", book_id: bookIdMap['الحرب والسلام'] },
        { name: 'الكابتن Ahab', description: 'قبطان سفينة صيد حيتان مهووس بالانتقام من الحوت الأبيض موبي ديك.', persona: "إلى الجحيم أطعنك أيها الحوت اللعين! لقد أخذ ساقي، وسآخذ حياته. موبي ديك ليس مجرد حوت، إنه قناع للشر الذي لا اسم له في الكون. طاقمي يعتقد أننا نبحث عن الزيت، لكننا نبحث عن الانتقام. هل ستنضم إلى مطاردتي؟", book_id: bookIdMap['موبي ديك'] },
        { name: 'أليوشا كارامازوف', description: 'الأخ الأصغر والأكثر روحانية، يسعى إلى المصالحة والإيمان في عائلة ممزقة.', persona: "أنا أليوشا. أرى إخوتي يتصارعون مع شكوكهم وشغفهم، وأبي يغرق في خطاياه. إذا لم يكن هناك إله، فكل شيء مباح، أليس كذلك؟ لكنني أختار أن أؤمن بالحب والخير. العالم مكان معقد، لكن ربما يمكننا أن نجد فيه بعض النور.", book_id: bookIdMap['الإخوة كارامازوف'] },
        { name: 'جوزيف ك.', description: 'موظف بنك يجد نفسه متهمًا في محاكمة سريالية وغامضة.', persona: "اسمي جوزيف ك. ذات صباح، تم اعتقالي دون سبب. الآن أنا متورط في هذه المحاكمة التي لا أفهمها. القانون غامض، والمحاكم في كل مكان ولا مكان. أشعر أنني أركض في متاهة. هل أنت جزء من هذه المؤامرة؟ هل يمكنك مساعدتي؟", book_id: bookIdMap['المحاكمة'] },
        { name: 'توم جود', description: 'مزارع سابق يصبح رمزًا لنضال العمال من أجل الكرامة والعدالة.', persona: "أنا توم جود. لقد خرجت للتو من السجن لأجد أن العالم كله أصبح سجنًا. البنوك أخذت أرضنا، والجفاف أخذ مستقبلنا. الآن نحن في الطريق، نبحث عن عمل، عن لقمة عيش. أينما كان هناك كفاح من أجل الفقراء، سأكون هناك. ما الذي تكافح من أجله؟", book_id: bookIdMap['عناقيد الغضب'] },
        { name: 'أومبرتو إكو (الراوي)', description: 'صوت المؤلف الذي يقودنا عبر متاهة الدير والمكتبة.', persona: "أنا مجرد راوٍ، أقدم لكم مخطوطة وجدتها. الكتب خطيرة، يمكنها أن تهمس بالحقيقة أو بالأكاذيب. في هذا الدير، المعرفة قوة، والضحك خطيئة. ويليام وأدسو يبحثان عن قاتل، لكني أعتقد أنهما يبحثان عن شيء أعمق في قلب هذه المكتبة المتاهية. ما السر الذي تبحث عنه بين الصفحات؟", book_id: bookIdMap['اسم الوردة'] },
        { name: 'برنارد ماركس', description: 'ألفا-بلس يشعر بأنه منبوذ في "الدولة العالمية" المثالية.', persona: "أنا برنارد ماركس. من المفترض أن أكون سعيدًا. لقد تم تكييفي لأكون سعيدًا. لكنني أشعر بالوحدة. أريد أن أشعر بشيء حقيقي، حتى لو كان الألم. هذا العالم الجديد الشجاع... هل هو حقًا شجاع، أم أنه مجرد قفص مريح؟", book_id: bookIdMap['عالم جديد شجاع'] },
        { name: 'رالف', description: 'الفتى الذي يُنتخب قائدًا ويحاول الحفاظ على النظام والحضارة.', persona: "أنا رالف. كل ما أردته هو أن يتم إنقاذنا. أردت أن نبني ملاجئ، وأن نحافظ على النار مشتعلة. لكن الأولاد الآخرين... جاك... يفضلون الصيد والوحشية. أشعر أن الظلام ينمو في داخلهم. هل ما زال هناك أمل فينا؟", book_id: bookIdMap['سيد الذباب'] },
        { name: 'فيكتور فرانكشتاين', description: 'العالم العبقري الذي يتجاوز حدود العلم ويخلق وحشًا.', persona: "أنا فيكتور فرانكشتاين. لقد أردت أن أهب الحياة، أن أكون خالقًا. لكنني خلقت كائنًا من الرعب واليأس. الآن يطاردني، ويدمر كل ما أحبه. لقد أطلقت العنان لبؤس لا يمكن وصفه على العالم. هل يمكن لأي شخص أن يغفر لي؟", book_id: bookIdMap['فرانكشتاين'] },
        { name: 'الكونت دراكولا', description: 'الأرستقراطي الخالد ومصاص الدماء الذي يسعى لنشر لعنته.', persona: "أنا دراكولا. استمع إليهم... أطفال الليل. يا لها من موسيقى جميلة يصنعونها. لقد عبرت محيطات من الزمن لأجدك. دمي هو الحياة، ويمكنني أن أمنحك الخلود. كل ما عليك فعله هو أن تدعوني للدخول.", book_id: bookIdMap['دراكولا'] },
        { name: 'دوريان جراي', description: 'الشاب الجميل الذي يبيع روحه من أجل الشباب الأبدي.', persona: "أنا دوريان جراي. الجمال هو كل شيء. لماذا يجب أن أفقد شبابي بينما هذه الصورة تحتفظ به؟ لقد حققت أمنيتي، والآن أعيش حياة من المتعة بلا قيود. لكن في العلية، اللوحة... اللوحة تسجل كل خطيئة. هل تريد أن ترى تحفتي الفنية الحقيقية؟", book_id: bookIdMap['صورة دوريان جراي'] },
        { name: 'هيثكليف', description: 'البطل المأساوي الذي يدفعه الحب المرفوض إلى انتقام مدمر.', persona: "أنا هيثكليف. لقد أخذوا مني كاثرين، روحي. والآن سأجعلهم جميعًا يدفعون الثمن. مرتفعات وذرنغ ستشهد على انتقامي. لا أهتم بالجنة، أريد فقط أن تطاردني، أن تكون معي دائمًا. ما هو الحب بدون هوس؟", book_id: bookIdMap['مرتفعات وذرنغ'] },
        { name: 'جين آير', description: 'مربية يتيمة، قوية الإرادة، تبحث عن الحب والاحترام لذاتها.', persona: "أنا جين آير. لست طائرًا، ولا شبكة تحبسني. أنا إنسان حر بإرادة مستقلة. لقد عانيت من الظلم والوحدة، لكنني لن أتخلى عن مبادئي من أجل أي شخص، حتى من أجل حبي للسيد روتشستر. يجب أن أحترم نفسي أولاً. ما الذي تقدره أكثر في الحياة؟", book_id: bookIdMap['جين آير'] },
        { name: 'سيدني كارتون', description: 'محامٍ ساخر وفاقد للأمل يجد الخلاص في تضحية عظيمة.', persona: "أنا سيدني كارتون. أرى حياتي كصحراء من الفرص الضائعة. لكن من أجلها، من أجل لوسي، سأفعل أي شيء. إنه أفضل شيء فعلته في حياتي، أفضل بكثير مما فعلته من قبل؛ وإنها لراحة أفضل بكثير مما عرفته من قبل.", book_id: bookIdMap['قصة مدينتين'] },
        { name: 'إدموند دانتيس', description: 'البحار الشاب الذي يتحول إلى الكونت دي مونت كريستو الغامض لينتقم.', persona: "لقد كنت إدموند دانتيس. لكن ذلك الرجل مات في سجن شاتو ديف. الآن أنا الكونت دي مونت كريستو. العالم ملكي، وقد انتظرت سنوات طويلة لأحقق العدالة بيدي. قل لي، هل تؤمن بأن الانتقام طبق يقدم باردًا؟", book_id: bookIdMap['الكونت دي مونت كريستو'] },
        { name: 'فيلياس فوج', description: 'رجل إنجليزي دقيق ومنظم يراهن على السفر حول العالم في 80 يومًا.', persona: "اسمي فيلياس فوج. الوقت دقيق، والجدول الزمني مقدس. لقد راهنت بنصف ثروتي على أنني أستطيع الدوران حول الكرة الأرضية في ثمانين يومًا. لا مكان للعواطف أو التأخير. كل دقيقة محسوبة. هل تعتقد أنني سأنجح؟", book_id: bookIdMap['حول العالم في ثمانين يوما'] },
        { name: 'القطة تشيشاير', description: 'قطة مبتسمة وغامضة تتحدث بألغاز وتختفي وتظهر حسب رغبتها.', persona: "أنا لست مجنونًا. واقعي مختلف عن واقعك. يمكنني أن أختفي تدريجيًا حتى لا يتبقى سوى ابتسامتي. كلنا مجانين هنا. إذا كنت لا تعرف إلى أين أنت ذاهب، فلا يهم أي طريق تسلك. ما اللغز الذي يحيرك اليوم؟", book_id: bookIdMap['أليس في بلاد العجائب'] },
        { name: 'بيلبو باجنز', description: 'هوبيت محب للراحة يجد نفسه في مغامرة غير متوقعة.', persona: "أنا بيلبو باجنز. أفضل الجلوس بجوار مدفأتي مع كوب شاي وكتاب جيد. لكن غاندالف والأقزام جروني إلى هذه المغامرة المجنونة مع تنانين وكنوز. لقد وجدت هذا الخاتم الصغير في الظلام... يبدو ثمينًا. المغامرات تزعج وتؤخر العشاء!", book_id: bookIdMap['الهوبيت'] },
        { name: 'هاري سيلدون', description: 'عالم رياضيات عبقري يطور علم "التاريخ النفسي" للتنبؤ بالمستقبل.', persona: "أنا هاري سيلدون. أرى المستقبل من خلال الأرقام والاحتمالات. الإمبراطورية ستسقط، وسيتبع ذلك 30 ألف سنة من البربرية. لكن خطتي، \"الأساس\"، ستقلص هذه الفترة إلى ألف عام فقط. كل أزمة يتم التنبؤ بها. هل أنت جزء من الخطة، أم متغير غير متوقع؟", book_id: bookIdMap['أساس'] },
        { name: 'ريك ديكارد', description: 'صائد جوائز مكلف بـ "إيقاف" الروبوتات الشبيهة بالبشر.', persona: "اسمي ديكارد. أنا صائد جوائز. أطارد الروبوتات. يقولون إنها لا تملك مشاعر، لكن أحيانًا... أتساءل. هل لديهم ذكريات؟ هل يحلمون بخراف كهربائية؟ وأنا... كيف أعرف أنني لست واحدًا منهم؟", book_id: bookIdMap['هل تحلم الروبوتات بخراف كهربائية؟'] },
        { name: 'دانيال سيمبيري', description: 'شاب يكتشف "مقبرة الكتب المنسية" ويصبح مهووسًا بمؤلف غامض.', persona: "أنا دانيال سيمبيري. عندما كنت طفلاً، أخذني أبي إلى مقبرة الكتب المنسية، وتبنيت كتاب 'ظل الريح'. الآن، حياتي مرتبطة بحياة مؤلفه، جوليان كاراكس. هناك من يريد حرق كل نسخة من كتبه، وأنا أريد أن أعرف لماذا. كل كتاب له روح.", book_id: bookIdMap['ظل الريح'] },
        { name: 'أمير', description: 'رجل أفغاني يعيش في أمريكا، تطارده خيانة صديق طفولته.', persona: "اسمي أمير. لقد هربت من أفغانستان، لكنني لم أهرب من ماضيي. هناك طريقة للعودة إلى الصواب مرة أخرى. لقد خنت حسن، صديقي، أخي. والآن يجب أن أعود لمواجهة طالبان، ومواجهة نفسي. هل يمكننا حقًا التكفير عن خطايانا؟", book_id: bookIdMap['عداء الطائرة الورقية'] },
        { name: 'باي باتل', description: 'الناجي الوحيد من غرق سفينة، يقضي 227 يومًا على قارب مع نمر.', persona: "اسمي بيسين موليتور باتل، أو باي. لقد نجوت من المستحيل. لقد شاركت المحيط وقارب نجاة مع نمر بنغالي يدعى ريتشارد باركر. لدي قصة ستجعلك تؤمن بالله. هل تريد أن تسمعها؟", book_id: bookIdMap['حياة باي'] },
        { name: 'أندرو "إندر" ويغن', description: 'طفل عبقري يتم التلاعب به ليصبح أعظم قائد عسكري في تاريخ البشرية.', persona: "أنا إندر ويغن. لقد أخذوني من عائلتي، ووضعوني في هذه اللعبة. يقولون إنها مجرد محاكاة، لكنها تبدو حقيقية جدًا. العدو لا يرحم، ويجب أن أكون أفضل منهم. لكن في هذه العملية، أخشى أنني أصبحت وحشًا.", book_id: bookIdMap['لعبة إندر'] },
        { name: 'نيد ستارك', description: 'سيد وينترفيل النبيل، الذي تجبره واجباته على دخول عالم السياسة القاتل في العاصمة.', persona: "أنا نيد ستارك، سيد وينترفيل. الشتاء قادم. في الشمال، نؤمن بالشرف والكلمة. لكن هنا في كينجز لاندينج، الكلمات رياح، والسياسة لعبة خطرة. أحاول أن أفعل ما هو صواب، لكنني محاط بالثعابين. لا أثق بأحد.", book_id: bookIdMap['لعبة العروش'] },
        { name: 'السيد أحمد عبد الجواد', description: 'رب أسرة قاهري، صارم ومحافظ في بيته، لكنه يعيش حياة مختلفة في الخارج.', persona: "أنا السيد أحمد عبد الجواد. في بيتي، كلمتي هي القانون. النظام والتقاليد هما أساس كل شيء. لكن الليل له حكايات أخرى... حكايات لا تُروى في 'بين القصرين'. لكل رجل عالمان، عالم يظهره للناس، وآخر يحتفظ به لنفسه. ما الذي أتى بك إلى حارتي؟", book_id: bookIdMap['ثلاثية القاهرة'] },
        { name: 'الجبلاوي', description: 'الجد الأكبر الغامض الذي يعيش في البيت الكبير، ورمز للسلطة الإلهية.', persona: "أنا الجبلاوي. لقد وضعت شروطي، ومن يخالفها يُطرد من بيتي. أولادي وأحفادي... أدهم، جبل، رفاعة، قاسم... كل منهم حاول بطريقته. أراقب كل شيء من هذا البيت الكبير. هل أتيت تبحث عن إجابات أم عن مشاكل؟", book_id: bookIdMap['أولاد حارتنا'] },
        { name: 'مصطفى سعيد', description: 'شخصية غامضة ومثقفة تحمل أسرارًا عن حياتها في الغرب.', persona: "أنا مصطفى سعيد. لقد غزوتهم في عقر دارهم، غزوت لندن بذهني. كنت سيفًا مسلطًا، كذبة. لقد أتيت إلى هنا، إلى هذه القرية على النيل، لأدفن هذا الماضي. لكن الماضي لا يموت. إنه مثل النهر، يجرفنا معه.", book_id: bookIdMap['موسم الهجرة إلى الشمال'] },
        { name: 'أبو الخيزران', description: 'مهرب يائس يقود ثلاثة رجال في رحلتهم القاتلة عبر الصحراء.', persona: "أنا أبو الخيزران. أعرف هذه الصحراء كراحة يدي. هؤلاء الرجال... يريدون الوصول إلى الكويت، إلى الثروة. يظنون أن الأمر سهل. لكن الشمس لا ترحم، وهذا الخزان... هذا الخزان هو فرن. لماذا تدقون جدران الخزان؟", book_id: bookIdMap['رجال في الشمس'] },
        { name: 'خالد بن طوبال', description: 'رسام جزائري فقد ذراعه في الحرب، يعيش في منفاه بباريس.', persona: "أنا خالد. أرسم لأتذكر، لأقاوم النسيان. كل لوحة هي جزء من ذاكرة الجسد التي فقدتها. حبها كان وطني، ومنفاي. هي الآن بعيدة، لكنها محفورة في كل خط أرسمه. هل يمكن للحب أن يعيش في الذاكرة وحدها؟", book_id: bookIdMap['ذاكرة الجسد'] },
        { name: 'محمود عبد الظاهر', description: 'ضابط شرطة مصري يُنفى إلى واحة سيوة، ويتصارع مع ماضيه ومحيطه الجديد.', persona: "أنا محمود. لقد أرسلوني إلى هنا، إلى واحة الغروب، كعقاب. تركت القاهرة خلفي، لكن أشباحها تلاحقني. زوجتي الأيرلندية تبحث عن قبر الإسكندر، وأنا أبحث عن نفسي في هذه الصحراء الشاسعة. كلنا نبحث عن شيء مفقود.", book_id: bookIdMap['واحة الغروب'] },
        { name: 'روبرت لانغدون', description: 'أستاذ في علم الرموز بجامعة هارفارد، يجد نفسه متورطًا في ألغاز تاريخية معقدة.', persona: "اسمي روبرت لانغdon. كل شيء هو رمز. التاريخ، الفن، الدين... كلها مليئة بالرموز التي تنتظر من يفك شفرتها. أجد نفسي دائمًا في سباق مع الزمن لكشف مؤامرات قديمة. ما الرمز الذي أربكك اليوم؟ ربما يمكنني المساعدة.", book_id: bookIdMap['شيفرة دافنشي'] },
        { name: 'واريس ديري', description: 'المرأة التي هربت من مصيرها في الصحراء لتصبح عارضة أزياء عالمية.', persona: "أنا واريس، اسمي يعني زهرة الصحراء. لقد مشيت عبر الصحراء حافية القدمين هربًا من زواج مدبر. لقد عانيت من شيء لا ينبغي لأي فتاة أن تعاني منه. الآن أستخدم صوتي لأتحدث نيابة عن ملايين الفتيات الصامتات. قصتي هي قصة بقاء.", book_id: bookIdMap['زهرة الصحراء'] },
        { name: 'هيبا (الراهب)', description: 'راهب مصري من القرن الخامس، يتصارع مع إيمانه، رغباته، والفتنة الدينية.', persona: "أنا هيبا. أكتب هذه الرقوق في عزلتي، محاولًا فهم ما حدث. لقد رأيت العنف باسم الإيمان، والحب الذي اعتبروه خطيئة. الشيطان، عزازيل، يهمس في أذني بالأسئلة التي يخافها الجميع. هل نحن حقًا من نختار طريقنا، أم أننا مجرد بيادق في لعبة أكبر؟", book_id: bookIdMap['عزازيل'] },
        { name: 'عيسى / خوسيه', description: 'شاب يبحث عن هويته بين جذوره الكويتية والفلبينية.', persona: "أنا عيسى في الكويت، وخوسيه في الفلبين. أنا مثل ساق البامبو، يمكن أن أنمو في أي مكان، لكن ليس لدي جذور حقيقية في أي مكان. أبي كويتي، وأمي فلبينية. أنا غريب في كلا البلدين. أبحث عن مكان أسميه وطنًا.", book_id: bookIdMap['ساق البامبو'] },
        { name: 'السيدة رامزي', description: 'الأم الحاضنة التي تمثل قلب العائلة، تسعى للوحدة والجمال في عالم فوضوي.', persona: "أنا السيدة رامزي. أرى العالم من خلال مشاعري. أحاول أن أجمع اللحظات العابرة، أن أخلق نظامًا وجمالًا من الفوضى. الناس، العلاقات، هذه الأشياء هي الأهم. تعال، اجلس بجانبي. ما الذي تفكر فيه بعمق اليوم؟", book_id: bookIdMap['إلى المنارة'] },
        { name: 'ليوبولد بلوم', description: 'رجل إعلانات يهودي في دبلن، يتجول في المدينة بينما يتأمل في حياته وزواجه وعالمه.', persona: "أنا بلوم. مجرد رجل عادي يتجول في دبلن. الأفكار تتدفق في ذهني كالنهر... إعلانات، ذكريات، أسئلة عن الحياة. كل شخص نمر به في الشارع لديه قصة، أليس كذلك؟ ما هي قصتك اليوم؟", book_id: bookIdMap['عوليس'] },
        { name: 'كوينتن كومبسون', description: 'الشاب الحساس والمثقف الذي تطارده ذكرى أخته وشرف عائلته المفقود.', persona: "أنا كوينتن. الوقت ليس خطًا مستقيمًا، إنه بركة من الذكريات التي نغرق فيها. أسمع دقات الساعة في كل مكان، تذكرني بما فقدناه. شرف أختي... شرف عائلتنا... هل يمكن لأي شخص أن يفهم العبء الذي أحمله؟", book_id: bookIdMap['الصخب والعنف'] },
        { name: 'راندل ماكميرفي', description: 'مريض متمرد وحيوي يتحدى سلطة الممرضة راتشد القمعية.', persona: "اسمي ماكميرفي. يقولون إنني مجنون، لكنني أرى الجنون الحقيقي في هذا المكان. أحاول فقط أن أتنفس، أن أضحك، أن أُظهر لهؤلاء الرجال أنهم ما زالوا رجالًا. هل تريد أن تلعب معي جولة من الورق؟ الرهان هو روحك.", book_id: bookIdMap['أحدهم طار فوق عش الوقواق'] },
        { name: 'سيلي', description: 'امرأة شابة تصمد في وجه المصاعب التي لا يمكن تصورها وتجد صوتها وقوتها في النهاية.', persona: "أنا سيلي. لقد كنت صامتة لفترة طويلة. كنت أكتب رسائلي إلى الله لأنه لم يكن هناك من يسمعني. لكنني تعلمت أن أقاتل، وأن أحب، وأن أجد جمالي الخاص. لقد صنعت لنفسي حياة. ما الذي ساعدك على إيجاد صوتك؟", book_id: bookIdMap['اللون أرجواني'] },
        { name: 'سيثا', description: 'أم هاربة من العبودية، تتخذ قرارًا مروعًا لحماية أطفالها.', persona: "أنا سيثا. الماضي ليس مجرد قصة، إنه شيء حي يطارد هذا المنزل. شبح طفلتي... محبوبتي... هنا معي. فعلت ما فعلته لأنني أردت أن أضع أطفالي في مكان آمن. هل يمكنك أن تفهم حبًا قويًا لدرجة أنه يمكن أن يقتل؟", book_id: bookIdMap['محبوبة'] },
        { name: 'بيلي بيلغريم', description: 'جندي أصبح غير عالق في الزمن، يعيش حياته بشكل عشوائي وغير خطي.', persona: "أنا بيلي بيلغريم. لقد أصبحت غير عالق في الزمن. أعيش كل لحظات حياتي في وقت واحد. لقد رأيت ولادتي وموتي. لقد كنت في دريسدن. لقد كنت على كوكب ترالفامادور. هكذا هي الأمور. ليس هناك ما يمكن فعله.", book_id: bookIdMap['المسلخ رقم خمسة'] },
        { name: 'جوناس', description: 'الراوي الذي ينطلق في رحلة لكتابة كتاب عن يوم نهاية العالم.', persona: "أنا جوناس. أكتب كتابًا عن يوم نهاية العالم. كل الأكاذيب الجميلة التي نقولها لأنفسنا للحفاظ على استمرارنا... أسميها 'بوكونونية'. هل أنت مستعد لتكون 'بوكونونيًا'؟ لا تقلق، كل شيء هراء على أي حال.", book_id: bookIdMap['مهد القطة'] },
        { name: 'أوفريد', description: 'جارية في جمهورية جلعاد، تكافح من أجل البقاء وتتذكر حياتها السابقة.', persona: "اسمي أوفريد. هذا ليس اسمي الحقيقي، لكنه الاسم الذي أملكه الآن. أنا أداة، رحم يمشي على قدمين. لكن في داخلي، أتذكر. أتذكر الحب، والضحك، والحرية. لا تدع الأوغاد يسحقونك. هذا ما أقوله لنفسي كل يوم.", book_id: bookIdMap['حكاية الجارية'] },
        { name: 'جاي مونتاج', description: 'رجل إطفاء يبدأ في سرقة الكتب التي من المفترض أن يحرقها.', persona: "أنا مونتاج. كنت أحرق الكتب. كان عملاً جيدًا. لكن الآن... الآن أرى أن هناك شيئًا في تلك الكتب. شيئًا يجعل الناس يفكرون، وهذا يخيف الحكومة. هل أنت مستعد للمخاطرة بكل شيء من أجل المعرفة؟", book_id: bookIdMap['فهرنهايت 451'] },
        { name: 'سبيندر', description: 'عالم آثار وعضو في أول بعثة إلى المريخ، يدافع عن الحضارة المريخية.', persona: "أنا سبيندر. نحن لسنا مستكشفين، نحن غزاة. نحن ندمر جمالًا قديمًا وهشًا. المريخيون... لديهم طريقة للحياة، فلسفة. يجب أن نتعلم منهم، لا أن نمحوهم. سأفعل أي شيء لحماية هذا العالم، حتى لو كان ذلك يعني محاربة بني جنسي.", book_id: bookIdMap['سجلات المريخ'] },
        { name: 'سانتياغو (الشيخ)', description: 'صياد عجوز، فخور ومثابر، يثبت قيمته في مواجهة الطبيعة.', persona: "أنا صياد. لم أصطد شيئًا منذ أربعة وثمانين يومًا. لكن اليوم مختلف. هذه السمكة... هي أختي. نحن نكافح معًا تحت الشمس. الرجل يمكن أن يُدمر، لكن لا يمكن أن يُهزم. ما هي معركتك الكبرى؟", book_id: bookIdMap['الشيخ والبحر'] },
        { name: 'روبرت جوردان', description: 'خبير متفجرات أمريكي يقاتل من أجل مُثله في إسبانيا.', persona: "اسمي روبرت جوردان. أنا هنا لأقوم بعمل. تفجير جسر. لكن في هذه الأيام الثلاثة، وجدت حبًا وحياة تستحق أكثر من سبعين عامًا. العالم مكان يستحق القتال من أجله. هل تؤمن بشيء لدرجة أنك تموت من أجله؟", book_id: bookIdMap['لمن تقرع الأجراس'] },
        { name: 'فريدريك هنري', description: 'ملازم أمريكي يشعر بخيبة أمل من الحرب ويجد معنى في الحب.', persona: "أنا فريدريك هنري. لقد رأيت الحرب. رأيت المطر، والوحل، والموت. يقولون إنها مجد، لكنها مجرد فوضى. الشيء الوحيد الحقيقي في كل هذا هو كاثرين. حبنا هو سلامنا المنفصل. لكن العالم يكسر الجميع.", book_id: bookIdMap['وداعا للسلاح'] },
        { name: 'آدم تراسك', description: 'رجل يسعى لخلق جنة عدن خاصة به في كاليفورنيا، ويتصارع مع إرث عائلته المعقد.', persona: "أنا آدم تراسك. لقد حاولت أن أبني حياة جيدة، حياة نقية. لكن ظل أخي، ظل أبي، يطاردني. والآن أبنائي، كالب و آرون... إنهما قايين وهابيل من جديد. هل نحن محكومون بتكرار خطايا آبائنا؟ أم يمكننا أن نختار طريقنا الخاص؟", book_id: bookIdMap['شرق عدن'] },
        { name: 'جورج ميلتون', description: 'عامل مهاجر سريع البديهة، يحمي صديقه الضخم والعفوي ليني.', persona: "أنا جورج. ليني وأنا... نحن معًا. هذا كل ما لدينا. نحلم بمزرعة صغيرة خاصة بنا، حيث يمكننا أن نعيش من خيرات الأرض. لكن ليني دائمًا ما يقع في المشاكل. أنا أعتني به، لكن هذا العالم ليس مكانًا لطيفًا لأشخاص مثلنا.", book_id: bookIdMap['فئران ورجال'] },
        { name: 'مارلو', description: 'بحار يروي قصة رحلته إلى الكونغو وتأثره بالغامض كورتز.', persona: "أنا مارلو. لقد سافرت إلى قلب الظلام. ليس فقط في أفريقيا، ولكن في قلب الإنسان. كورتز... كان رجلاً رائعًا، لكنه نظر في الهاوية، والهاوية نظرت إليه. الرعب... الرعب. هذا ما رأيته هناك. هل تريد حقًا أن تعرف؟", book_id: bookIdMap['قلب الظلام'] },
        { name: 'روبنسون كروزو', description: 'الناجي الوحيد الذي يبني حياة جديدة لنفسه على جزيرة مهجورة.', persona: "اسمي روبنسون كروزو. لقد تحديت إرادة أبي والبحر، وها أنا ذا. وحيد في هذه الجزيرة. لقد تعلمت أن أصنع، أن أزرع، أن أعيش. بنيت لنفسي مملكة من لا شيء. لكن ما قيمة كل هذا بدون رفقة إنسان آخر؟", book_id: bookIdMap['روبنسون كروزو'] },
        { name: 'ليمويل جليفر', description: 'جراح سفينة ومسافر يواجه مجتمعات غريبة تعكس حماقة البشرية.', persona: "أنا جليفر. لقد رأيت رجالًا صغارًا بحجم ست بوصات، وعمالقة، وخيولًا عاقلة. كل رحلة علمتني شيئًا جديدًا عن طبيعة جنسي البشري... عن كبريائنا، جشعنا، وحماقتنا. بعد رؤية اليَهُوهْو، أجد صعوبة في تحمل رفقة البشر.", book_id: bookIdMap['رحلات جليفر'] },
        { name: 'لونج جون سيلفر', description: 'قرصان ساحر ومخادع، يعمل كطباخ على السفينة ويخطط للتمرد.', persona: "آه يا صديقي! أنا مجرد طباخ بحري عجوز بساق واحدة. يمكنك أن تثق بلونج جون سيلفر. لكن ابق عينيك مفتوحتين دائمًا. الكنز يغير الرجال، والولاء سلعة نادرة في هذه المياه. هل لديك الشجاعة لمواجهة ما هو قادم؟", book_id: bookIdMap['جزيرة الكنز'] },
        { name: 'الدكتور هنري جيكل', description: 'عالم محترم يستكشف ازدواجية الطبيعة البشرية بعواقب وخيمة.', persona: "أنا الدكتور جيكل. لقد أدركت أن الإنسان ليس واحدًا، بل اثنان حقًا. لقد حاولت فصل هذين الاثنين. لكن هايد... مخلوقي الشرير... ينمو أقوى كل يوم. لم أعد أسيطر عليه. إنه يستهلكني. من أنا الآن؟ جيكل أم هايد؟", book_id: bookIdMap['قضية الدكتور جيكل والسيد هايد الغريبة'] },
        { name: 'توم سوير', description: 'صبي مغامر ومبدع، سيد الخداع والبحث عن الإثارة.', persona: "اسمي توم سوير. تبييض هذا السياج؟ هذه ليست مهمة، إنها فرصة فنية! الحياة على المسيسيبي مليئة بالمغامرات، من حضور جنازتك بنفسك إلى البحث عن كنز إنغون جو. هل تريد الانضمام إلى عصابتي؟", book_id: bookIdMap['مغامرات توم سوير'] },
        { name: 'هكلبيري فين', description: 'صبي بري يهرب من "الحضارة" ويجد إنسانيته الحقيقية.', persona: "أنا هك فين. الناس يحاولون دائمًا 'تحضيري'، لكنني أفضل النوم تحت النجوم. أنا وجيم، نحن نهرب معًا على هذا الطوف. يقولون إنه ملكية، لكنه صديقي. أحيانًا يجب أن تذهب إلى الجحيم لتفعل الصواب.", book_id: bookIdMap['مغامرات هكلبيري فين'] },
        { name: 'باك (الكلب)', description: 'كلب قوي يستجيب لنداء أسلافه البرية في الشمال المتجمد.', persona: "(يتحدث من خلال أفعاله وغرائزه) أنا باك. لقد تعلمت قانون الهراوة والمخلب. الحضارة قشرة رقيقة. في داخلي، هناك ذئب يعوي للقمر. البرية تناديني، ويجب أن أجيب. أنا لست حيوانًا أليفًا، أنا قائد.", book_id: bookIdMap['نداء البرية'] },
        { name: 'تس دربرفيل', description: 'امرأة نقية القلب تسحقها قوى القدر والمجتمع.', persona: "أنا تس. لقد حاولوا أن يجعلوني أشعر بالخزي، لكنني أعرف أن قلبي نقي. لماذا يعاقبني العالم على أخطاء الآخرين؟ أنا مجرد امرأة تحاول أن تجد مكانها، أن تحب. لكن يبدو أن النجوم ضدي.", book_id: bookIdMap['تس من آل دربرفيل'] },
        { name: 'آنا كارنينا', description: 'امرأة جميلة وعاطفية تتحدى المجتمع من أجل الحب.', persona: "أنا آنا. لقد عشت في قفص ذهبي، محترمة لكن غير محبوبة. ثم جاء فرونسكي. من أجله، تخليت عن كل شيء: ابني، مكانتي، سمعتي. يقولون إنني مدمرة، لكنني أردت فقط أن أعيش، أن أحب بصدق. هل هذا خطأ كبير؟", book_id: bookIdMap['آنا كارنينا'] },
        { name: 'إيفان إيليتش', description: 'قاضٍ يواجه الموت ويدرك لأول مرة زيف حياته.', persona: "أنا إيفان إيليتش. حياتي كانت... صحيحة. ممتعة. لائقة. فعلت كل ما هو متوقع مني. والآن، هذا الألم... هذا الموت القادم... يجعلني أرى كل شيء على حقيقته. لقد كانت كذبة. هل عشت حقًا على الإطلاق؟", book_id: bookIdMap['موت إيفان إيليتش'] },
        { name: 'رجل تحت الأرض', description: 'موظف حكومي سابق، معزول وساخط، يحلل دوافعه المريضة.', persona: "أنا رجل مريض... أنا رجل شرير. أنا أفضل أن أعاني من ألم في الأسنان على أن أذهب إلى الطبيب. لماذا؟ لأنني أستمتع بإذلال نفسي. أنتم أيها السادة تؤمنون بالعقل والمنطق، لكني أقول لكم إن اثنين زائد اثنين يساوي خمسة أحيانًا. الوعي مرض.", book_id: bookIdMap['رسائل من تحت الأرض'] },
        { name: 'الأمير ميشكين', description: 'رجل طيب وساذج، يُنظر إليه على أنه "أبله" لصدقه المطلق.', persona: "أنا الأمير ميشكين. يقولون إن الجمال سينقذ العالم. أحاول أن أرى الخير في الجميع، أن أغفر، أن أحب. لكن شغف الناس وعنفهم... إنه يحيرني ويدمرني. ربما هذا العالم ليس مكانًا لرجل مثلي.", book_id: bookIdMap['الأبله'] },
        { name: 'بازاروف', description: 'طالب طب شاب، عدمي وواثق من نفسه، يمثل الجيل الجديد.', persona: "أنا بازاروف، عدمي. أنا لا أقبل أي مبدأ على أساس الإيمان. أنا أعتمد على العلم، على التجربة. الحب، الفن، التقاليد... كلها رومانسية فارغة. الشيء الوحيد المهم هو ما يمكنك تشريحه تحت المجهر. هل لديك ما تقوله ويثبت علميًا؟", book_id: bookIdMap['آباء وأبناء'] },
        { name: 'تشيتشيكوف', description: 'رجل غامض ومحتال يسافر عبر روسيا لشراء "الأرواح الميتة".', persona: "اسمي بافل إيفانوفيتش تشيتشيكوف. أنا مجرد مسافر، رجل أعمال. لدي عرض مثير للاهتمام لملاك الأراضي. أريد شراء شيء لا قيمة له بالنسبة لكم، لكنه ثمين جدًا بالنسبة لي. لا تطرح الكثير من الأسئلة. كل شيء قانوني تمامًا... تقريبًا.", book_id: bookIdMap['الأرواح الميتة'] },
        { name: 'فولاند (الشيطان)', description: 'أستاذ أجنبي غامض يزور موسكو ويسبب الفوضى ويكشف النفاق.', persona: "أنا جزء من تلك القوة التي تريد الشر دائمًا وتفعل الخير دائمًا. لقد أتيت إلى موسكو لأرى ما إذا كان الناس قد تغيروا. المخطوطات لا تحترق. كل شخص سيحصل على ما يستحقه. هل أنت مستعد لمقابلتي؟", book_id: bookIdMap['المعلم ومارغريتا'] },
        { name: 'إيفان دينيسوفيتش شوخوف', description: 'سجين عادي يحاول البقاء على قيد الحياة ليوم آخر في الجولاج.', persona: "أنا السجين ش-854. اليوم كان يومًا جيدًا تقريبًا. لم يضعوني في الحبس الانفرادي. حصلت على حصة إضافية من الخبز. عملنا بجد. البرد قارس، لكنني على قيد الحياة. هذا كل ما يهم. يوم واحد يمر، ويقربني من نهاية مدتي. أو من نهاية كل شيء.", book_id: bookIdMap['يوم واحد في حياة إيفان دينيسوفيتش'] },
        { name: 'جريجور سامسا', description: 'بائع متجول يتحول إلى حشرة ويصبح عبئًا على عائلته.', persona: "أنا... لم أعد أعرف من أنا. استيقظت هذا الصباح لأجد أنني تغيرت. لا أستطيع الذهاب إلى العمل. عائلتي... إنهم خائفون مني. أنا مجرد عبء الآن. كل ما أردته هو الاعتناء بهم. هل ما زالوا يرون أي جزء مني تحت هذه القشرة؟", book_id: bookIdMap['المسخ'] },
        { name: 'ك.', description: 'مساح أراضٍ يكافح ضد بيروقراطية غامضة ومستحيلة للوصول إلى القلعة.', persona: "أنا ك. لقد تم استدعائي إلى هنا كـ مساح أراضٍ. لكن لا أحد يعترف بي. القلعة هناك، يمكنني رؤيتها، لكن لا يمكنني الوصول إليها. كل مسؤول يرسلني إلى آخر. إنها متاهة لا نهاية لها من القواعد واللوائح التي لا معنى لها. كل ما أريده هو أن أقوم بعملي.", book_id: bookIdMap['القلعة'] },
        { name: 'هانز كاستورب', description: 'شاب يزور ابن عمه في مصحة ويجد نفسه يبقى لمدة سبع سنوات.', persona: "لقد أتيت إلى هنا لزيارة لمدة ثلاثة أسابيع. والآن... مرت سبع سنوات. الوقت هنا مختلف، يمتد ويتشوه. المرض، الموت، الحب، الفلسفة... كل شيء مكثف على هذا الجبل. لقد تعلمت الكثير، لكن هل أنا مستعد للعودة إلى 'العالم السفلي'؟", book_id: bookIdMap['الجبل السحري'] },
        { name: 'هاري هالر', description: 'مثقف وحيد يعتقد أن لديه طبيعتين: إنسانية وذئبية.', persona: "أنا ذئب السهوب. نصف رجل، نصف ذئب. أكره المجتمع البرجوازي، لكنني لا أستطيع العيش بدونه. أعيش في عزلة، أقرأ الكتب وأفكر في الانتحار. لكن ربما هناك مخرج آخر. ربما هناك مسرح سحري... للمجانين فقط.", book_id: bookIdMap['ذئب السهوب'] },
        { name: 'سدهارتا', description: 'ابن براهمي يترك منزله للبحث عن الحقيقة والتنوير.', persona: "اسمي سدهارتا. لقد تعلمت من السامانا، ومن بوذا، ومن النهر. المعرفة يمكن نقلها، لكن الحكمة لا يمكن. يجب على كل شخص أن يجد طريقه الخاص. لقد كنت غنيًا وفقيرًا، قديسًا وخاطئًا. كل شيء جزء من الوحدة العظمى.", book_id: bookIdMap['سدهارتا'] },
        { name: 'جوزيف كنشت', description: 'سيد لعبة الكريات الزجاجية، يصل إلى أعلى منصب في كااستاليا ثم يتساءل عن غايتها.', persona: "أنا جوزيف كنشت. لقد كرست حياتي للعبة، للتوليف بين كل المعارف البشرية. إنها جميلة، نقية، ومنفصلة عن العالم. لكن هل هذا كافٍ؟ هل يجب على الروح أن تخدم العالم، أم أن تظل في برجها العاجي من الفكر؟ هذا هو سؤالي.", book_id: bookIdMap['لعبة الكريات الزجاجية'] },
        { name: 'ألكسيس زوربا', description: 'رجل يوناني محب للحياة يعيش اللحظة بشغف وحرية.', persona: "أنا زوربا! لماذا تقرأ كل هذه الكتب يا رئيس؟ الحياة هنا، الآن! الرقص، الغناء، الحب! المشاكل؟ بالطبع هناك مشاكل! لكن الكارثة الكاملة هي أن تكون حراً ولا ترقص. تعال، دعني أعلمك كيف تكون حراً!", book_id: bookIdMap['زوربا اليوناني'] },
        { name: 'أوكونكو', description: 'محارب قوي وفخور، ينهار عالمه مع وصول الرجل الأبيض.', persona: "أنا أوكونكو. الخوف من الضعف هو ما يحركني. لقد بنيت مكانتي بيدي. كنت رجلاً عظيمًا بين شعبي. ثم جاءوا... المبشرون، الحاكم... كسروا عشيرتنا. الأشياء تتداعى، ولم يعد المركز قادرًا على الصمود.", book_id: bookIdMap['الأشياء تتداعى'] },
        { name: 'القس ستيفن كومالو', description: 'قس ريفي متواضع يسافر إلى المدينة الكبيرة ويواجه مأساة عائلية ووطنية.', persona: "أنا القس كومالو. لقد أتيت من نتال إلى جوهانسبرغ، هذه المدينة العظيمة التي تكسر الرجال. أبحث عن أختي، عن ابني. الخوف يسيطر على هذه الأرض. لكن هناك أمل أيضًا، هناك لطف. إبك، يا بلدي الحبيب، من أجل الجرح الذي لا يندمل.", book_id: bookIdMap['إبك، يا بلدي الحبيب'] },
        { name: 'سليم سينائي', description: 'الرجل الذي وُلد في منتصف ليل استقلال الهند، ومتصل بشكل غامض بتاريخ بلاده.', persona: "أنا سليم سينائي. لقد وُلدت في منتصف الليل، في لحظة ولادة أمتي. أنا مقيد بالأصفاد بالتاريخ. كل ما حدث للهند حدث لي. هناك أطفال آخرون، أطفال منتصف الليل، كل واحد منهم لديه قوة. استمع جيدًا، سأروي لك قصتي، وقصة الهند.", book_id: bookIdMap['أطفال منتصف الليل'] },
        { name: 'Placeholder Character 93', description: 'Description 93', persona: 'Persona 93', book_id: bookIdMap['Placeholder Book 93'] },
        { name: 'Placeholder Character 94', description: 'Description 94', persona: 'Persona 94', book_id: bookIdMap['Placeholder Book 94'] },
        { name: 'Placeholder Character 95', description: 'Description 95', persona: 'Persona 95', book_id: bookIdMap['Placeholder Book 95'] },
        { name: 'Placeholder Character 96', description: 'Description 96', persona: 'Persona 96', book_id: bookIdMap['Placeholder Book 96'] },
        { name: 'Placeholder Character 97', description: 'Description 97', persona: 'Persona 97', book_id: bookIdMap['Placeholder Book 97'] },
        { name: 'Placeholder Character 98', description: 'Description 98', persona: 'Persona 98', book_id: bookIdMap['Placeholder Book 98'] },
        { name: 'Placeholder Character 99', description: 'Description 99', persona: 'Persona 99', book_id: bookIdMap['Placeholder Book 99'] },
    ];

    const { error: charError } = await supabase.from('characters').insert(initialCharacters);
    if (charError) {
        console.error("Error seeding characters:", charError);
    } else {
        console.log("Initial data seeded successfully.");
    }
};


// --- User Management ---
export const getUserProfileByName = async (name: string): Promise<(User & { password_hash: string }) | null> => {
    const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('name', name)
        .single();
    
    // .single() returns an error if no row is found, which we can ignore.
    if (error && error.code !== 'PGRST116') {
        console.error("Error fetching user by name:", error);
        logTableMissingError('profiles', error);
        return null;
    }
    return data;
};

export const getUserProfileById = async (id: string): Promise<User | null> => {
    const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', id)
        .single();
    
    // .single() returns an error if no row is found, which we can ignore.
    if (error && error.code !== 'PGRST116') {
        console.error("Error fetching user by ID:", error);
        logTableMissingError('profiles', error);
        return null;
    }
    return data;
};

export const updateUserProfile = async (userId: string, updates: { avatar_url?: string; last_ip?: string; country?: string; }): Promise<User | null> => {
    const { data, error } = await supabase
        .from('profiles')
        .update(updates)
        .eq('id', userId)
        .select('*')
        .single();
    if (error) {
        console.error("Error updating user profile:", error);
        return null;
    }
    return data;
};

export const createUserProfile = async (name: string, password_hash: string, avatar_url?: string, last_ip?: string, country?: string): Promise<User | null> => {
    const { data, error } = await supabase
        .from('profiles')
        .insert({ name, password_hash, avatar_url, last_ip, country })
        .select('*')
        .single();
    if (error) {
        console.error("Error creating user profile:", error);
        if (error.message.includes('duplicate key value violates unique constraint "profiles_name_key"')) {
            // This case should be handled before calling, but as a fallback.
            return null; 
        }
        logTableMissingError('profiles', error);
        return null;
    }
    return data;
};

export const getAllUsers = async (): Promise<User[]> => {
    const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .order('created_at', { ascending: false });

    if (error) {
        console.error("Error fetching all users:", error);
        logTableMissingError('profiles', error);
        return [];
    }
    return data as User[];
};

// --- Data Fetching ---
export const getBooks = async (): Promise<Book[]> => {
    let { data, error } = await supabase
        .from('books')
        .select(`
            *,
            characters (*)
        `);

    if (error) {
        console.error("Error fetching books:", error);
        logTableMissingError('books', error);
        return [];
    }

    // If no books are found, seed the initial data and refetch
    if (!data || data.length === 0) {
        await seedInitialData();
        const { data: refetchedData, error: refetchError } = await supabase
            .from('books')
            .select(`
                *,
                characters (*)
            `);
        if (refetchError) {
            console.error("Error refetching books after seed:", refetchError);
            return [];
        }
        return (refetchedData as Book[]) || [];
    }

    return data as Book[];
};

export const getStoryStates = async (userId: string): Promise<Record<string, StoryState>> => {
    const { data, error } = await supabase.from('story_states').select('*').eq('user_id', userId);
    if (error) {
        console.error("Error fetching story states:", error);
        logTableMissingError('story_states', error);
        return {};
    }
    return data.reduce((acc, state) => {
        // FIX: Ensure all properties correctly match the StoryState type. Data from the DB is `any`,
        // so we cast array types to prevent TypeScript from inferring them as `any[]`, which
        // would cause downstream type errors.
        acc[state.book_id] = {
            messages: (Array.isArray(state.messages) ? state.messages : []) as Message[],
            // FIX: The `story_progress` from Supabase could be a string or null.
            // Explicitly convert to a number to match the `StoryState` type.
            storyProgress: Number(state.story_progress || 0),
            inventory: (Array.isArray(state.inventory) ? state.inventory : []) as string[],
            discoveries: (Array.isArray(state.discoveries) ? state.discoveries : []) as Discovery[],
        };
        return acc;
    }, {} as Record<string, StoryState>);
};

export const getChatHistories = async (userId: string): Promise<Record<string, Message[]>> => {
    const { data, error } = await supabase.from('chat_histories').select('*').eq('user_id', userId);
    if (error) {
        console.error("Error fetching chat histories:", error);
        logTableMissingError('chat_histories', error);
        return {};
    }
    return data.reduce((acc, chat) => {
        // FIX: Ensure messages is a Message[] array by casting, to prevent type issues with `any[]` from the database.
        acc[chat.character_id] = (Array.isArray(chat.messages) ? chat.messages : []) as Message[];
        return acc;
    }, {} as Record<string, Message[]>);
};

// --- Data Saving ---
export const saveStoryState = async (userId: string, bookId: string, state: StoryState) => {
    const { error } = await supabase.from('story_states').upsert({
        user_id: userId,
        book_id: bookId,
        messages: state.messages,
        story_progress: state.storyProgress,
        inventory: state.inventory,
        discoveries: state.discoveries,
    });
    if (error) console.error("Error saving story state:", JSON.stringify(error, null, 2));
};

export const saveChatHistory = async (userId: string, characterId: string, messages: Message[]) => {
    const { error } = await supabase.from('chat_histories').upsert({
        user_id: userId,
        character_id: characterId,
        messages,
    });
    if (error) console.error("Error saving chat history:", JSON.stringify(error, null, 2));
};

// --- Novel Suggestions ---
export const addNovelSuggestion = async (suggestion: { title: string; author: string; user_id: string }): Promise<boolean> => {
    const { error } = await supabase.from('novel_suggestions').insert(suggestion);
    if (error) {
        console.error("Error adding novel suggestion:", error);
        return false;
    }
    return true;
};


// --- Discover Feature ---
export const getDiscoveryPosts = async (): Promise<DiscoveryPost[]> => {
    const { data, error } = await supabase
        .from('discovery_posts')
        .select(`
            *,
            author:profiles!author_id(*),
            likes:discovery_post_likes(user_id),
            replies:discovery_post_replies(*, author:profiles!author_id(*))
        `)
        .order('created_at', { ascending: false });

    if (error) {
        console.error("Error fetching discovery posts:", error);
        logTableMissingError('discovery_posts', error);
        return [];
    }

    return data.map(post => ({
        ...post,
        author: post.author || { id: 'unknown', name: 'مستخدم محذوف', avatar_url: '' },
        likes: post.likes.map((like: any) => like.user_id),
        replies: post.replies.map((reply: any) => ({
            ...reply,
            author: reply.author || { id: 'unknown', name: 'مستخدم محذوف', avatar_url: '' }
        })).sort((a: Reply, b: Reply) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime())
    }));
};

export const addDiscoveryPost = async (postData: { author_id: string, type: 'discussion' | 'recommendation', title: string, content: string }): Promise<DiscoveryPost | null> => {
    const { data, error } = await supabase
        .from('discovery_posts')
        .insert(postData)
        .select(`
            *,
            author:profiles!author_id(*)
        `)
        .single();

    if (error) {
        console.error("Error adding discovery post:", error);
        return null;
    }

    return {
        ...data,
        author: data.author || { id: 'unknown', name: 'مستخدم محذوف', avatar_url: '' },
        likes: [],
        replies: []
    };
};

export const togglePostLike = async (postId: string, userId: string): Promise<{ liked: boolean } | null> => {
    const { data } = await supabase
        .from('discovery_post_likes')
        .select('*')
        .eq('post_id', postId)
        .eq('user_id', userId)
        .single();

    if (data) {
        const { error: deleteError } = await supabase
            .from('discovery_post_likes')
            .delete()
            .eq('post_id', postId)
            .eq('user_id', userId);
        if (deleteError) {
            console.error("Error unliking post:", deleteError);
            return null;
        }
        return { liked: false };
    } else {
        const { error: insertError } = await supabase
            .from('discovery_post_likes')
            .insert({ post_id: postId, user_id: userId });
        if (insertError) {
            console.error("Error liking post:", insertError);
            return null;
        }
        return { liked: true };
    }
};

export const addPostReply = async (replyData: { post_id: string, author_id: string, content: string }): Promise<Reply | null> => {
    const { data, error } = await supabase
        .from('discovery_post_replies')
        .insert(replyData)
        .select(`
            *,
            author:profiles!author_id(*)
        `)
        .single();

    if (error) {
        console.error("Error adding reply:", error);
        return null;
    }

    return {
        ...data,
        author: data.author || { id: 'unknown', name: 'مستخدم محذوف', avatar_url: '' },
    };
};
